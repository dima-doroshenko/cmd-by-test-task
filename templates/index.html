<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GetWeather</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå§Ô∏è GetWeather</h1>
            <p>–£–∑–Ω–∞–π—Ç–µ –ø–æ–≥–æ–¥—É –≤ –ª—é–±–æ–º –≥–æ—Ä–æ–¥–µ</p>
        </div>
        
        <div class="content">
            <div class="search-form">
                <input type="text" id="cityInput" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..." value="–ú–∏–Ω—Å–∫">
                <button onclick="getWeather()" class="search-button">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–≥–æ–¥—É</button>
            </div>
            
            <div id="error" class="error"></div>
            
            <div id="weatherCard" class="weather-card">
                <h2 id="weatherCity"></h2>
                <div class="weather-info">
                    <div class="weather-item">
                        <div class="weather-value" id="temperature"></div>
                        <div class="weather-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="humidity"></div>
                        <div class="weather-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å (%)</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="pressure"></div>
                        <div class="weather-label">–î–∞–≤–ª–µ–Ω–∏–µ (–º–º —Ä—Ç.—Å—Ç.)</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-value" id="description"></div>
                        <div class="weather-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                    </div>
                </div>
            </div>
            
            <div class="history-section">
                <div class="history-header">
                    <h3>üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
                    <div class="history-info" id="historyInfo"></div>
                </div>
                <div id="historyList"></div>
                <div class="pagination" id="pagination">
                    <button onclick="changePage(-1)" id="prevBtn">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                    <span class="pagination-info" id="pageInfo"></span>
                    <button onclick="changePage(1)" id="nextBtn">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/v1/weather';
        let currentPage = 1;
        let pageSize = 10;
        let totalPages = 1;
        let totalItems = 0;
        
        async function getWeather() {
            const cityInput = document.getElementById('cityInput');
            const city = cityInput.value.trim();
            
            if (!city) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞');
                return;
            }
            
            try {
                showError('');
                showLoading(true);
                
                const response = await fetch(`${API_BASE}/${encodeURIComponent(city)}`);
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }
                
                const weatherData = await response.json();
                displayWeather(city, weatherData);
                loadHistory(1);
                
            } catch (error) {
                showError(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
        
        function displayWeather(city, data) {
            document.getElementById('weatherCity').textContent = city;
            document.getElementById('temperature').textContent = `${data.temp}¬∞C`;
            document.getElementById('humidity').textContent = `${data.humidity}%`;
            document.getElementById('pressure').textContent = data.pressure;
            document.getElementById('description').textContent = data.description;
            document.getElementById('weatherCard').style.display = 'block';
        }
        
        async function loadHistory(page = 1) {
            try {
                const response = await fetch(`${API_BASE}/history?page=${page}&size=${pageSize}`);
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞: ${response.status}`);
                }
                
                const historyData = await response.json();
                displayHistory(historyData);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                showError(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏: ${error.message}`);
            }
        }
        
        function displayHistory(data) {
            const { items, total_items, total_pages, page, size } = data;
            
            currentPage = page;
            totalPages = total_pages;
            totalItems = total_items;
            pageSize = size;
            
            const historyList = document.getElementById('historyList');
            const historyInfo = document.getElementById('historyInfo');
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            historyInfo.textContent = `–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${totalItems}`;
            pageInfo.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}`;
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            
            if (items.length === 0) {
                historyList.innerHTML = '<p class="loading">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—É—Å—Ç–∞</p>';
                return;
            }
            
            historyList.innerHTML = items.map(item => `
                <div class="history-item">
                    <div class="history-city">${item.city}</div>
                    <div class="history-time">${new Date(item.created_at).toLocaleString('ru-RU')}</div>
                    <div>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${item.data.temp}¬∞C, –í–ª–∞–∂–Ω–æ—Å—Ç—å: ${item.data.humidity}%, ${item.data.description}</div>
                </div>
            `).join('');
        }
        
        function changePage(delta) {
            const newPage = currentPage + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                loadHistory(newPage);
            }
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = message ? 'block' : 'none';
        }
        
        function showLoading(show) {
            const button = document.querySelector('.search-button');
            button.textContent = show ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–ü–æ–ª—É—á–∏—Ç—å –ø–æ–≥–æ–¥—É';
            button.disabled = show;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadHistory(1);
        });
        
        document.getElementById('cityInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                getWeather();
            }
        });
    </script>
</body>
</html> 